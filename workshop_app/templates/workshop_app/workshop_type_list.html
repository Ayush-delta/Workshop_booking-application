{% extends "workshop_app/base.html" %}

{% block title %}
    Workshop Types
{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="row mb-5 fade-in">
        <div class="col-12 text-center">
            <div class="hero-section p-5 rounded" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white;">
                <h1>Discover Workshops</h1>
                <p class="lead">Explore our range of workshops tailored for college students. Find topics from Python basics to advanced skills.</p>
                <div class="search-section mt-4">
                    <div class="input-group">
                        <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="Search workshops by name or topic...">
                        <div class="input-group-append">
                            <button class="btn btn-accent" type="button"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="row mb-4 fade-in">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5>Filters</h5>
                    <div class="row">
                        <div class="col-md-3">
                            <select id="categoryFilter" class="form-control">
                                <option value="">All Categories</option>
                                <option value="python">Python</option>
                                <option value="data">Data Science</option>
                                <option value="web">Web Development</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="dateFilter" class="form-control">
                                <option value="">All Dates</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="past">Past</option>
                            </select>
                        </div>
                        <div class="col-md-6 text-right">
                            <button id="clearFilters" class="btn btn-outline-secondary">Clear Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workshop Cards -->
    <div class="row" id="workshopGrid">
        {% for workshop_type in workshop_type %}
            <div class="col-md-6 col-lg-4 mb-4 workshop-card" data-category="{% if workshop_type.name|lower|contains:'python' %}python{% elif workshop_type.name|lower|contains:'data' %}data{% elif workshop_type.name|lower|contains:'web' %}web{% else %}other{% endif %}" data-date="upcoming">
                <div class="card h-100">
                    <img src="https://via.placeholder.com/400x200?text={{ workshop_type.name|truncatechars:20 }}" class="card-img-top" alt="{{ workshop_type.name }}" style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <h5 class="card-title">{{ workshop_type.name|capfirst }}</h5>
                        <p class="card-text">{{ workshop_type.description|truncatechars:100 }}</p>
                        <div class="tags mb-2">
                            <span class="badge badge-secondary">Python</span>
                            <span class="badge badge-secondary">Beginner</span>
                            <span class="badge badge-secondary">Online</span>
                        </div>
                        <a href="#" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#detailsModal{{ workshop_type.id }}">View Details</a>
                        <a href="{% url 'workshop_app:propose_workshop' %}" class="btn btn-accent btn-sm ml-1">Register</a>
                    </div>
                </div>
            </div>

            <!-- Details Modal -->
            <div class="modal fade" id="detailsModal{{ workshop_type.id }}" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel{{ workshop_type.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="detailsModalLabel{{ workshop_type.id }}">{{ workshop_type.name|capfirst }}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>{{ workshop_type.description }}</p>
                            <p><strong>Terms & Conditions:</strong> <a href="#" data-toggle="modal" data-target="#tncModal{{ workshop_type.id }}">View T&Cs</a></p>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Instructors</h6>
                                    <p>TBA</p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Duration</h6>
                                    <p>4 hours</p>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <a href="{% url 'workshop_app:propose_workshop' %}" class="btn btn-primary">Register Now</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- T&Cs Modal -->
            <div class="modal fade" id="tncModal{{ workshop_type.id }}" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Terms & Conditions - {{ workshop_type.name }}</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>{{ workshop_type.terms_and_conditions|linebreaks }}</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <i class="fas fa-search fa-3x text-light mb-3"></i>
                        <h3>No Workshops Found</h3>
                        <p>Try adjusting your search or filters.</p>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="row fade-in">
        <div class="col-12">
            <nav aria-label="Workshop pagination">
                <ul class="pagination justify-content-center">
                    {% if workshop_type.has_previous %}
                        <li class="page-item"><a class="page-link" href="?page={{ workshop_type.previous_page_number }}">Previous</a></li>
                    {% endif %}
                    {% for num in workshop_type.paginator.page_range %}
                        <li class="page-item {% if workshop_type.number == num %}active{% endif %}"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                    {% endfor %}
                    {% if workshop_type.has_next %}
                        <li class="page-item"><a class="page-link" href="?page={{ workshop_type.next_page_number }}">Next</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Search functionality
    $('#searchInput').on('keyup', function() {
        var value = $(this).val().toLowerCase();
        $('.workshop-card').filter(function() {
            $(this).toggle($(this).find('.card-title').text().toLowerCase().indexOf(value) > -1 || $(this).find('.card-text').text().toLowerCase().indexOf(value) > -1);
        });
    });

    // Filter functionality
    $('#categoryFilter, #dateFilter').on('change', function() {
        var category = $('#categoryFilter').val();
        var date = $('#dateFilter').val();
        $('.workshop-card').each(function() {
            var show = true;
            if (category && !$(this).data('category').includes(category)) show = false;
            if (date && !$(this).data('date').includes(date)) show = false;
            $(this).toggle(show);
        });
    });

    // Clear filters
    $('#clearFilters').on('click', function() {
        $('#categoryFilter, #dateFilter').val('');
        $('.workshop-card').show();
        $('#searchInput').val('');
    });
});
</script>

<style>
.btn-accent {
    background-color: var(--accent);
    border-color: var(--accent);
    color: white;
}

.btn-accent:hover {
    background-color: #ea580c;
    border-color: #ea580c;
}

.tags .badge {
    margin-right: 0.5rem;
}

.hero-section {
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.search-section .input-group {
    max-width: 500px;
    margin: 0 auto;
}

.card-img-top {
    transition: transform 0.3s ease;
}

.card:hover .card-img-top {
    transform: scale(1.05);
}
</style>
{% endblock %}
